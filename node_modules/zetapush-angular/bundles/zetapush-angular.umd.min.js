!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("zetapush-js"),require("rxjs/Observable"),require("rxjs/add/operator/publish"),require("@angular/core")):"function"==typeof define&&define.amd?define(["exports","zetapush-js","rxjs/Observable","rxjs/add/operator/publish","@angular/core"],e):e(n.zetapushAngular=n.zetapushAngular||{},n.zetapushJs,n.rxjs_Observable,null,n.ng.core)}(this,function(n,e,t,o,r){"use strict";function i(n,e,t){var o=f(t,e),r=o.extensions,i=o.listener,u=n.createAsyncMacroService({Type:t,listener:i}),c=u.$publish;return u.$publish=function(n,t,o,r){return new Promise(function(i,u){console.warn("Api::"+n,t);var s=function(n){return e.run(function(){return i(n)})},a=function(n){return e.run(function(){return u(n)})};c(n,t,o,r).then(s,a)})},Object.assign(u,r,{$getUserId:function(){return n.getUserId()}})}function u(n){return new h(n)}function c(n){return new d(n)}var s=function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])};return function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),a=function(n){return void 0===n&&(n=""),""+n.charAt(0).toUpperCase()+n.substring(1)},f=function(n,e){var o=function(n){return"constructor"!==n},r=Object.getOwnPropertyNames(n.prototype).filter(o),i={},u=r.reduce(function(n,o){var r=new t.Observable(function(t){n[o]=function(n){var r=n.data;console.log("Api::on"+a(o),r),e.run(function(){var n=r.errors,e=r.result;n.length?t.error(e):t.next(e)})}}),u=r.publish();return i["on"+a(o)]=u,u.connect(),n},{});return{extensions:i,listener:u}},p=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return s(e,n),e.prototype.$getUserId=function(){return"<abstract>"},e}(e.services.Macro),l=function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])};return function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),h=function(n){function t(t){var o=n.call(this,t)||this,r=o.helper.authentication;return o.helper.authentication=function(){var n=o.getDelegateToken();return n?e.Authentication.delegating({token:n}):r()},o}return l(t,n),t.prototype.getDelegateToken=function(){return localStorage.getItem("ServicesAuthToken")},t}(e.SmartClient),d=function(){function n(n){this.client=n}return n.prototype.disconnect=function(){var n=this;return new Promise(function(e,t){var o=n.client,r=[];if(o.isConnected()){var i=function(){console.log("ZetaPushConnection::onConnectionClosed"),r.forEach(function(n){o.removeConnectionStatusListener(n)}),e()};r.push(o.onConnectionClosed(i)),o.disconnect()}else e()})},n.prototype.connect=function(n){var e=this;return void 0===n&&(n={}),new Promise(function(t,o){var r=e.client,i=[];r.setCredentials(n),e.disconnect().then(function(){var n=function(n){console.log("ZetaPushConnection::onFailedHandshake",n),i.forEach(function(n){r.removeConnectionStatusListener(n)}),r.connect(),o()},e=function(){console.log("ZetaPushConnection::onConnectionEstablished"),i.forEach(function(n){r.removeConnectionStatusListener(n)}),t()};i.push(r.onConnectionEstablished(e)),i.push(r.onFailedHandshake(n)),r.connect()})})},n}(),v=new r.InjectionToken("ZetaPushClientConfig"),g=function(){function n(){}return n}();g.decorators=[{type:r.NgModule,args:[{declarations:[],imports:[],providers:[{provide:h,useFactory:u,deps:[v]},{provide:d,useFactory:c,deps:[h]}],bootstrap:[]}]}],g.ctorParameters=function(){return[]},n.Api=p,n.createApi=i,n.ZetaPushConnection=d,n.ZetaPushClient=h,n.ZetaPushClientConfig=v,n.ZetaPushModule=g,n.ɵa=u,n.ɵb=c,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=zetapush-angular.umd.min.js.map
